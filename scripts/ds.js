var duoshuoQuery = {short_name:"banrime"}; //多说ID
!function(t,e){if(!t.DUOSHUO){for(var s in Object.prototype)return alert("Object.prototype 不为空，请不要给 Object.prototype 设置方法");!function(t,e,s){"use strict";var i=t._={},o=e.getElementsByTagName("head")[0]||e.getElementsByTagName("body")[0];i.extend=function(t,e){for(var s in e)t[s]=e[s];return t},i.injectStylesheet=function(t,s){var i=e.createElement("link");i.type="text/css",i.rel="stylesheet",i.href=t,s&&(i.onload=s),o.appendChild(i)},i.injectScript=function(i,o){var n=e.createElement("script"),a=e.head||e.getElementsByTagName("head")[0]||e.documentElement;n.type="text/javascript",n.src=i,n.async="async",n.charset="utf-8",o&&(n.onload=n.onreadystatechange=function(e,i){var r=i||!n.readyState||/loaded|complete/.test(n.readyState);r&&(n.onload=n.onreadystatechange=null,a&&n.parentNode&&a.removeChild(n),n=s,i||o.call(t))}),a.insertBefore(n,a.firstChild)},i.injectStyle=function(t){var s=e.createElement("style");return s.type="text/css",o.appendChild(s),t=t.replace(/\}/g,"}\n"),s.styleSheet?s.styleSheet.cssText=t:s.appendChild(e.createTextNode(t)),s},i.getCookie=function(t){for(var i,o,n,a=" "+t+"=",r=e.cookie.split(";"),d=0;d<r.length;d++)if(i=" "+r[d],o=i.indexOf(a),o>=0&&o+a.length==(n=i.indexOf("=")+1))return decodeURIComponent(i.substring(n,i.length).replace(/\+/g,""));return s},i.param=function(t){var e=[];for(var i in t)t[i]!=s&&e.push(i+"="+encodeURIComponent(t[i]));return e.join("&")},i.cssProperty=function(t,s){var i=(e.body||e.documentElement).style;if("undefined"==typeof i)return!1;if("string"==typeof i[t])return s?t:!0;for(var o=["Moz","Webkit","ms"],t=t.charAt(0).toUpperCase()+t.substr(1),n=0;n<o.length;n++)if("string"==typeof i[o[n]+t])return s?o[n]+t:!0}}(t,e);var i=("https:"==e.location.protocol?"https:":"http:")+"//static.duoshuo.com";if(e.all&&!e.addEventListener)return t._.injectScript(i+"/embed-classic.unstable.js"),!1;!function(){function s(t){var e={val:t},s=t.split(/\s+in\s+/);return s[1]&&(e.val=U(0)+s[1],s=s[0].slice(U(0).length).trim().split(/,\s*/),e.key=s[0],e.pos=s[1]),e}function i(t,e,s){var i={};return i[t.key]=e,t.pos&&(i[t.pos]=s),i}function o(t,e,o){function n(t,e,s){p.splice(t,0,e),m.splice(t,0,s)}h(t,"each");var a,d=t.outerHTML,c=t.previousSibling,l=t.parentNode,p=[],m=[];o=s(o),e.one("update",function(){l.removeChild(t)}).one("premount",function(){l.stub&&(l=e.root)}).on("update",function(){var t=k(o.val,e);if(t){if(!Array.isArray(t)){var s=JSON.stringify(t);if(s==a)return;a=s,u(m,function(t){t.unmount()}),p=[],m=[],t=Object.keys(t).map(function(e){return i(o,e,t[e])})}u(p,function(e){if(e instanceof Object){if(t.indexOf(e)>-1)return}else{var s=g(t,e),i=g(p,e);if(s.length>=i.length)return}var o=p.indexOf(e),n=m[o];n&&(n.unmount(),p.splice(o,1),m.splice(o,1))});var h=[].slice.call(l.childNodes),f=h.indexOf(c);u(t,function(s,c){var u=t.indexOf(s,c),v=p.indexOf(s,c);if(0>u&&(u=t.lastIndexOf(s,c)),0>v&&(v=p.lastIndexOf(s,c)),!(s instanceof Object)){var b=g(t,s),y=g(p,s);b.length>y.length&&(v=-1)}if(0>v){p.push(s),!a&&o.key&&(s=i(o,s,u));var _=new r({tmpl:d},{before:h[f+1+u],parent:e,root:l,item:s});return _.mount(),n(u,s,_)}return o.pos&&m[v][o.pos]!=u&&(m[v].one("update",function(t){t[o.pos]=u}),m[v].update()),u!=v?(l.insertBefore(h[f+v+1],h[f+u+1]),n(u,p.splice(v,1)[0],m.splice(v,1)[0])):void 0}),p=t.slice()}})}function n(t,e,s){f(t,function(t){if(1==t.nodeType){var i=b(t);if(i&&!t.getAttribute("each")){var o=new r(i,{root:t,parent:e});e.tags[t.getAttribute("name")||i.name]=o,t.innerHTML="",s.push(o)}u(t.attributes,function(s){/^(name|id)$/.test(s.name)&&(e[s.value]=t)})}})}function a(t,e,s){function i(t,e,i){if(e.indexOf(U(0))>=0){var o={dom:t,expr:e};s.push(p(o,i))}}f(t,function(t){var s=t.nodeType;if(3==s&&"STYLE"!=t.parentNode.tagName&&i(t,t.nodeValue),1==s){var n=t.getAttribute("each");return n?(o(t,e,n),!1):(u(t.attributes,function(e){var s=e.name,o=s.split("__")[1];return i(t,e.value,{attr:o||s,bool:o}),o?(h(t,s),!1):void 0}),b(t)?!1:void 0)}})}function r(t,e){function s(){u(Object.keys(U),function(t){d[t]=k(U[t],h||r)})}function i(t){if(u(g,function(e){e[t?"mount":"unmount"]()}),h){var e=t?"on":"off";h[e]("update",r.update)[e]("unmount",r.unmount)}}var o,r=O.observable(this),d=v(e.opts)||{},c=m(t.tmpl),h=e.parent,f=[],g=[],b=e.root,y=e.item,_=t.fn,U={};_&&b.riot||(b.riot=!0,p(this,{parent:h,root:b,opts:d,tags:{}},y),u(b.attributes,function(t){U[t.name]=t.value}),this.update=function(t){p(r,t,y),s(),r.trigger("update",y),l(f,r,y),r.trigger("updated")},this.mount=function(){if(s(),_&&_.call(r,d),i(!0),a(c,r,f),r.update(),r.trigger("premount"),_)for(;c.firstChild;)b.appendChild(c.firstChild);else o=c.firstChild,b.insertBefore(o,e.before||null);b.stub&&(r.root=b=h.root),r.trigger("mount")},this.unmount=function(){var t=_?b:o,e=t.parentNode;if(e){if(h)e.removeChild(t);else for(;b.firstChild;)b.removeChild(b.firstChild);i(),r.trigger("unmount"),r.off("*"),delete b.riot}},n(c,this,g))}function d(e,s,i,o,n){i[e]=function(e){e=e||t.event,e.which=e.which||e.charCode||e.keyCode,e.target=e.target||e.srcElement,e.currentTarget=i,e.item=n,s.call(o,e)!==!0&&(e.preventDefault&&e.preventDefault(),e.returnValue=!1);var a=n?o.parent:o;a.update()}}function c(t,e,s){t&&(t.insertBefore(s,e),t.removeChild(e))}function l(t,s,i){u(t,function(t){var o=t.dom,n=t.attr,a=k(t.expr,s),r=t.dom.parentNode;if(null==a&&(a=""),r&&"TEXTAREA"==r.tagName&&(a=a.replace(/riot-/g,"")),t.value!==a){if(t.value=a,!n)return o.nodeValue=a;if(h(o,n),"function"==typeof a)d(n,a,o,s,i);else if("if"==n){var l=t.stub;a?l&&c(l.parentNode,l,o):(l=t.stub=l||e.createTextNode(""),c(o.parentNode,o,l))}else if(/^(show|hide)$/.test(n))"hide"==n&&(a=!a),o.style.display=a?"":"none";else if("value"==n)o.value=a;else if("riot-"==n.slice(0,5))n=n.slice(5),a?o.setAttribute(n,a):h(o,n);else{if(t.bool){if(o[n]=a,!a)return;a=n}"object"!=typeof a&&o.setAttribute(n,a)}}})}function u(t,e){for(var s,i=0,o=(t||[]).length;o>i;i++)s=t[i],null!=s&&e(s,i)===!1&&i--;return t}function h(t,e){t.removeAttribute(e)}function p(t,e,s){return e&&u(Object.keys(e),function(s){t[s]=e[s]}),s?p(t,s):t}function m(t){var s=t.trim().slice(1,3).toLowerCase(),i=/td|th/.test(s)?"tr":"tr"==s?"tbody":"div",o=e.createElement(i);return o.stub=!0,o.innerHTML=t,o}function f(t,e){if(t)if(e(t)===!1)f(t.nextSibling,e);else for(t=t.firstChild;t;)f(t,e),t=t.nextSibling}function g(t,e){return t.filter(function(t){return t===e})}function v(t){function e(){}return e.prototype=t,new e}function b(t){return w[t.tagName.toLowerCase()]}function y(t){var s=e.createElement("style");s.innerHTML=t,e.head.appendChild(s)}function _(t,e,s){var i=w[e];return i&&t&&(i=new r(i,{root:t,opts:s})),i&&i.mount?(i.mount(),S.push(i),i.on("unmount",function(){S.splice(S.indexOf(i),1)})):void 0}var O={version:"v2.0.13",settings:{}};O.observable=function(t){t=t||{};var e={},s=0;return t.on=function(i,o){return"function"==typeof o&&(o._id="undefined"==typeof o._id?s++:o._id,i.replace(/\S+/g,function(t,s){(e[t]=e[t]||[]).push(o),o.typed=s>0})),t},t.off=function(s,i){return"*"==s?e={}:s.replace(/\S+/g,function(t){if(i)for(var s,o=e[t],n=0;s=o&&o[n];++n)s._id==i._id&&(o.splice(n,1),n--);else e[t]=[]}),t},t.one=function(e,s){return s&&(s.one=1),t.on(e,s)},t.trigger=function(s){for(var i,o=[].slice.call(arguments,1),n=e[s]||[],a=0;i=n[a];++a)i.busy||(i.busy=1,i.apply(t,i.typed?[s].concat(o):o),i.one?(n.splice(a,1),a--):n[a]!==i&&a--,i.busy=0);return e.all&&"all"!=s&&t.trigger.apply(t,["all",s].concat(o)),t},t},function(e,s){function i(){return r.href.split("#")[1]||""}function o(t){return t.split("/")}function n(t){t.type&&(t=i()),t!=a&&(d.trigger.apply(null,["H"].concat(o(t))),a=t)}if(this.top){var a,r=location,d=e.observable(),c=t,l=e.route=function(t){t[0]?(r.hash=t,n(t)):d.on("H",t)};l.exec=function(t){t.apply(null,o(i()))},l.parser=function(t){o=t},c.addEventListener?c.addEventListener(s,n,!1):c.attachEvent("on"+s,n)}}(O,"hashchange");var U=function(t,e,s){return function(i){return e=O.settings.brackets||t,s!=e&&(s=e.split(" ")),i&&i.test?e==t?i:RegExp(i.source.replace(/\{/g,s[0].replace(/(?=.)/g,"\\")).replace(/\}/g,s[1].replace(/(?=.)/g,"\\")),i.global?"g":""):s[i]}}("{ }"),k=function(){function e(t,e){return t=(t||U(0)+U(1)).replace(U(/\\{/g),"￰").replace(U(/\\}/g),"￱"),e=o(t,n(t,U(/{/),U(/}/))),new Function("d","return "+(e[0]||e[2]||e[3]?"["+e.map(function(t,e){return e%2?s(t,!0):'"'+t.replace(/\n/g,"\\n").replace(/"/g,'\\"')+'"'}).join(",")+'].join("")':s(e[1])).replace(/\uFFF0/g,U(0)).replace(/\uFFF1/g,U(1))+";")}function s(t,e){return t=t.replace(/\n/g," ").replace(U(/^[{ ]+|[ }]+$|\/\*.+?\*\//g),""),/^\s*[\w- "']+ *:/.test(t)?"["+n(t,/["' ]*[\w- ]+["' ]*:/,/,(?=["' ]*[\w- ]+["' ]*:)|}|$/).map(function(t){return t.replace(/^[ "']*(.+?)[ "']*: *(.+?),? *$/,function(t,e,s){return s.replace(/[^&|=!><]+/g,i)+'?"'+e+'":"",'})}).join("")+'].join(" ").trim()':i(t,e)}function i(e,s){return e=e.trim(),e?"(function(v){try{v="+(e.replace(r,function(e,s,i){return i?"(d."+i+"===undefined?"+("undefined"==typeof t?"global.":"window.")+i+":d."+i+")":e})||"x")+"}finally{return "+(s===!0?'!v&&v!==0?"":v':"v")+"}}).call(d)":""}function o(t,e){var s=[];return e.map(function(e,i){i=t.indexOf(e),s.push(t.slice(0,i),e),t=t.slice(i+e.length)}),s.concat(t)}function n(t,e,s){var i,o=0,n=[],a=new RegExp("("+e.source+")|("+s.source+")","g");return t.replace(a,function(e,s,a,r){!o&&s&&(i=r),o+=s?1:-1,o||null==a||n.push(t.slice(i,r+a.length))}),n}var a={},r=/(['"\/]).*?[^\\]\1|\.\w*|\w*:|\b(?:(?:new|typeof|in|instanceof) |(?:this|true|false|null|undefined)\b|function *\()|([a-z_$]\w*)/gi;return function(t,s){return t&&(a[t]=a[t]||e(t))(s)}}(),S=[],w={};O.tag=function(t,e,s,i){"function"==typeof s?i=s:s&&y(s),w[t]={name:t,tmpl:e,fn:i}},O.mount=function(t,s,i){function o(t){var e=s||t.tagName.toLowerCase(),o=_(t,e,i);o&&n.push(o)}"*"==t&&(t=Object.keys(w).join(", ")),"object"==typeof s&&(i=s,s=0);var n=[];return t.tagName?(o(t),n[0]):(u(e.querySelectorAll(t),o),n)},O.update=function(){return u(S,function(t){t.update()})},O.mountTo=O.mount,O.util={brackets:U,tmpl:k},"object"==typeof exports?module.exports=O:"function"==typeof define&&define.amd?define(function(){return O}):this.riot=O}(),function(t,e){"use strict";function s(t){t&&(this.el=t.length?t[0]:t,t.length>1&&(this.els=t))}function i(t){if("object"==typeof t)return new s(t);var i="querySelectorAll";return 0===t.indexOf("#")&&(i="getElementById",t=t.substr(1,t.length)),new s(e[i](t))}function o(t){var e=this.el;if(e)return e.classList?e.classList.add(t):void(e.className+=" "+t)}function n(t){var e=this.el;if(e)return e.classList?e.classList.remove(t):void(e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi")," "))}function a(t){var e=this.el;if(e)return e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className)}function r(t){(this.el||this.els.length)&&Array.prototype.forEach.call(this.els||[this.el],t,this)}function d(t){return this.el?"undefined"==typeof t?this.el.innerHTML:void(this.el.innerHTML=t):void 0}function c(t){this.el&&(this.el.outerHTML=t)}function l(){this.el&&(this.el.innerHTML="")}function u(t,e){var s=this.el;if(s&&s.getAttribute&&s.setAttribute)return"undefined"==typeof e?s.getAttribute(t):s.setAttribute(t,e)}function h(){return this.el?this.el.parentNode:void 0}function p(){return this.el?this.el.textContent:void 0}function m(){if(this.el&&this.el.getBoundingClientRect){var t=this.el.getBoundingClientRect();return{top:t.top+e.body.scrollTop,left:t.left+e.body.scrollLeft,height:t.height}}}function f(){return this.el?{left:this.el.offsetLeft,top:this.el.offsetTop}:void 0}function g(t,e){this.el&&this.el.addEventListener&&this.el.addEventListener(t,e)}function v(t,e){this.el&&this.el.removeEventListener&&this.el.removeEventListener(t,e)}function b(){this.el&&this.el.parentNode.removeChild(this.el)}function y(t){return"loading"!=e.readyState?t():void e.addEventListener("DOMContentLoaded",t)}t.$ds=i,t._documentReady=y,s.prototype.addClass=o,s.prototype.removeClass=n,s.prototype.hasClass=a,s.prototype.each=r,s.prototype.html=d,s.prototype.replaceWith=c,s.prototype.empty=l,s.prototype.attr=u,s.prototype.parent=h,s.prototype.text=p,s.prototype.offset=m,s.prototype.position=f,s.prototype.remove=b,s.prototype.on=g,s.prototype.off=v}(t,e),function(t,e){"use strict";function s(){var e=t.console;return e&&e.error&&e.warn?e:{error:function(){},log:function(){},warn:function(){}}}function i(t,e){r.smilies[t]=e}function o(t,e){t&&!selectors[t]&&(selectors[t]=e||{type:"EmbedThread"}),r.initView&&r.initView()}function n(){var s=t.navigator.userAgent,i=e.createElement("div");i.innerHTML='<a href="/a" style="opacity:.55;">a</a><input type="checkbox"/>';var o=i.getElementsByTagName("a")[0],n=i.getElementsByTagName("input")[0],a={placeholder:"placeholder"in n,touch:"ontouchstart"in t||"onmsgesturechange"in t,opacity:/^0.55$/.test(o.style.opacity),hrefNormalized:"/a"===o.getAttribute("href"),iOS:s.match(/ \((iPad|iPhone|iPod);( U;)? CPU( iPhone)? OS /),android:s.match(/ \(Linux; U; Android /),ie6:!t.XMLHttpRequest&&"undefined"==typeof i.style.maxHeight};return a.authInWin=t.postMessage&&t.screen.width>800&&!a.iOS&&!a.android&&t.location.origin,a}function a(){function e(t){var e=r._libsMd5[t]?"?"+r._libsMd5[t]+".js":"";return r.STATIC_URL+"/libs/"+t+".js"+e}var s={};return s.mzadxN="undefined"!=typeof mzadxN,"undefined"!=typeof jQuery&&jQuery.fn.jquery>="1.5"&&(s["embed.compat"]=!0,r.jQuery=t.jQuery),function(t,i){if("string"==typeof t)return s[t]?i():_.injectScript(e(t),function(){s[t]=!0,i()});if("object"==typeof t){var o,n=!0;for(o=0;o<t.length;o++)!function(a){s[t[o]]||(n=!1,_.injectScript(e(a),function(){s[a]=!0;for(var e=0;e<t.length;e++)if(!s[t[e]])return;i()}))}(t[o]);n&&i()}}}t.console=s(),String.prototype.trim||!function(){var t=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(t,"")}}();var r=t.DUOSHUO={};r._timeOffset=0,r.sourceName={weibo:"新浪微博",qq:"QQ",qzone:"QQ空间",qqt:"腾讯微博",renren:"人人网",douban:"豆瓣网",netease:"网易微博",kaixin:"开心网",sohu:"搜狐微博",baidu:"百度",taobao:"淘宝",msn:"MSN",google:"谷歌",wechat:"微信",diandian:"点点网",duitang:"堆糖",youdao:"有道云笔记",pengyou:"朋友网",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin",huaban:"花瓣网",mogujie:"蘑菇街",meilishuo:"美丽说"},r.serviceNames={weibo:"微博",qq:"QQ",douban:"豆瓣",renren:"人人",netease:"网易",kaixin:"开心",sohu:"搜狐",baidu:"百度",taobao:"淘宝",msn:"MSN",google:"谷歌",wechat:"微信",diandian:"点点",duitang:"堆糖",youdao:"有道云笔记",pengyou:"朋友网",facebook:"Facebook",twitter:"Twitter",linkedin:"Linkedin",huaban:"花瓣网",mogujie:"蘑菇街",meilishuo:"美丽说"},r.commonServices=["weibo","qq","renren","douban"],r.additionalServices=["kaixin","baidu","google"],r.init=o,r.require=a(),r.env={},r.env.ie=e.all,r.env.protocol="https:"==e.location.protocol?"https:":"http:",r.support=n(),r.addSmilies=i,r.status={},r.smilies={},r.visitor={},r.site={},r.unread={},r._components={},r._notifications=[]}(t,e),function(t,e,s,i){"use strict";function o(){for(var t={},e=0;e<arguments.length;e++)arguments[e]&&N.extend(t,arguments[e]);var s=N.param(t);return s?"?"+s:""}function n(){var t=N.getCookie("duoshuo_token");return t?{jwt:t}:duoshuoQuery.remote_auth?{short_name:duoshuoQuery.short_name,remote_auth:duoshuoQuery.remote_auth}:i}function a(){if(!duoshuoQuery&&(duoshuoQuery=t.duoshuoQuery)){if(!duoshuoQuery.short_name||"your_duoshuo_short_name"===duoshuoQuery.short_name)return duoshuoQuery=i,void alert("你还没有设置多说域名(duoshuoQuery.short_name)，填入已有域名或创建新站点：http://duoshuo.com/create-site/");E.events.trigger("queryDefined")}return duoshuoQuery}function r(){return duoshuoQuery.short_name?s.env.protocol+"//"+duoshuoQuery.short_name+"."+s.DOMAIN:s.REMOTE}function d(t){if(t.match(/^(http|https):/))return t;var i=e.createElement("a");return i.href=t,s.support.hrefNormalized?i.href:i.getAttribute("href",4)}function c(){function e(){for(var e;e=L.shift();){var s=e.url,i=new A(e.title,{dir:"auto",icon:e.iconUrl,body:e.body});try{i.onclick=function(){t.focus(),location.href=s,i.close()}}catch(o){}setTimeout(function(){i.close&&i.close()},8e3)}}"Notification"in t&&"denied"!==A.permission&&("granted"===A.permission&&e(),A.requestPermission(function(t){"granted"===t&&e()}))}function l(){return"undefined"!=typeof s.visitor&&s.visitor.data?0==s.visitor.data.user_id:!0}function u(t){return Q?Q[t]:void 0}function h(t,e){if(Q)try{var i=s._timeOffset;Q.removeItem(t),Q[t]=JSON.stringify(e),Q.removeItem(t+":timestamp"),Q[t+":timestamp"]=Math.floor((new Date-i)/1e3)}catch(o){}}function p(t,e){s.theme=t,"none"!==t&&N.injectStylesheet(s.STATIC_URL+"/styles/embed"+(t?"."+t+".css?"+s._styleMd5[t]:"."+short_name)+".css",e)}function m(t,e){if(t.visitor){var i=!s.visitor.data&&t.visitor.user_id&&A&&!A.requestPermission();i&&s.ws.send({logged_user_id:t.visitor.user_id}),s.visitor.data=t.visitor}if(t.site&&(s.site.data=t.site,R.save("ds_site_"+duoshuoQuery.short_name,t.site)),!s.theme&&s.site.data.theme&&p(s.site.data.theme,e),t.lang&&(N.extend(s._lang,t.lang),R.save("ds_lang_"+duoshuoQuery.short_name,t.lang)),t.stylesheets)for(var o=0;o<t.stylesheets.length;o++)N.injectStylesheet(t.stylesheets[o]);if(t.nonce&&(s.nonce=t.nonce),t.style&&N.injectStyle((t.style||"")+U(duoshuoQuery.component_style)),t.unread&&(s.unread.data=t.unread),t.warnings)for(var o=0;o<t.warnings.length;o++)console.warn(t.warnings[o])}function f(){function t(t){return e[t]||"&amp;"}var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},s=/&(?!\w+;)|[<>"'`]/g,i=/[&<>"'`]/;return function(e){return null==e||e===!1?"":i.test(e)?e.replace(s,t):e}}function g(t,i){t=b(t);var o={require:i&&i.initRequest?"site,visitor,nonce,lang,unread,log,extraCss":"",site_ims:R.get("ds_site_"+duoshuoQuery.short_name+":timestamp"),lang_ims:R.get("ds_lang_"+duoshuoQuery.short_name+":timestamp"),referer:e.referrer};duoshuoQuery.stylePatch&&(o.style_patch=duoshuoQuery.stylePatch);for(var n in o)o[n]&&(!s.support.ie6||encodeURIComponent(o[n]).length<200)&&(t[n]=o[n]);return t}function v(t,e){for(var s={},i=t.split(" "),o=0;o<i.length;o++)!function(t){(e[t]||e["data-"+t])&&(s[b(t)]=e[t]||e["data-"+t])}(i[o]);return s}function b(t){if("string"==typeof t)return t.replace(/-/g,"_");var e=["class"],s=["data-","-"];for(var i in t)!function(i){if(e.indexOf(i)>-1)return void delete t[i];for(var o=0,n=0;n<s.length;n++)-1===i.indexOf(s[n])&&o++;if(o!==s.length){var a=i;a.indexOf("data-")>-1&&(a=a.replace("data-","")),a.indexOf("-")>-1&&(a=a.replace(/-/g,"_")),t[a]=t[i],delete t[i]}}(i);return t}function y(t){return t.parse("2011-10-28T00:00:00+08:00")&&function(e){return new t(e)}||t.parse("2011/10/28T00:00:00+0800")&&function(e){return new t(e.replace(/-/g,"/").replace(/:(\d\d)$/,"$1"))}||t.parse("2011/10/28 00:00:00+0800")&&function(e){return new t(e.replace(/-/g,"/").replace(/:(\d\d)$/,"$1").replace("T"," "))}||function(e){return new t(e)}}function _(t){var e=E.parseDate(t);return e.getFullYear()+"年"+(e.getMonth()+1)+"月"+e.getDate()+"日 "+e.toLocaleTimeString()}function O(t){var e=E.parseDate(t),i=new Date,o=(i-s._timeOffset-e)/1e3;return 10>o?"刚刚":60>o?Math.round(o)+"秒前":3600>o?Math.round(o/60)+"分钟前":86400>o?Math.round(o/3600)+"小时前":(i.getFullYear()==e.getFullYear()?"":e.getFullYear()+"年")+(e.getMonth()+1)+"月"+e.getDate()+"日"}function U(t){var e="",s={};if(s.textbox="#ds-thread #ds-reset .ds-replybox .ds-textarea-wrapper",!t)return e;for(var i in t)e+=s[i]+"{"+t[i]+"}\n";return e}function k(t){return r()+"/bind/"+t+"/"+o(duoshuoQuery.sso&&duoshuoQuery.sso.login?{sso:1,redirect_uri:duoshuoQuery.sso.login}:null,n())}function S(t,e){return e||(e={}),duoshuoQuery.sso&&duoshuoQuery.sso.login&&(e.sso=1,e.redirect_uri=duoshuoQuery.sso.login),r()+"/login/"+t+"/"+o(e)}function w(){return r()+"/logout/"+o(duoshuoQuery.sso&&duoshuoQuery.sso.logout?{sso:1,redirect_uri:duoshuoQuery.sso.logout}:null)}function x(t,s){var i=e.body;if(!(0>s)){var o=t-i.scrollTop,n=o/s*10;setTimeout(function(){i.scrollTop=i.scrollTop+n,i.scrollTop!==t&&x(t,s-10)},10)}}function D(t,e,s){return j("#dsDialogContent").empty(),I.tag&&I.tag[0]&&I.tag[0].unmount(),I.tag=riot.mount("#dsDialogContent",t,e||{}),I.trigger("open",e),s&&"function"==typeof s&&s(),I.tag}function H(){I.tag&&I.tag[0]&&(I.tag[0].unmount(),I.trigger("close"))}function T(e){function i(e,s){var i=t.location,o={weibo:[760,600],renren:[420,322],qq:[504,445],netease:[810,645],sohu:[972,600],google:[600,440],taobao:[480,585]}[e]||[550,400];return t.open(s+(-1==s.indexOf("?")?"?":"&")+N.param({origin:i.origin||"http://"+i.host}),"_blank","width="+o[0]+",height="+o[1]+",toolbar=no,menubar=no,location=yes")}if(!s.support.authInWin)return void(t.location.href=e);var o=e.match(/\/(login|bind)\/(\w+)\//i);if(o&&s.serviceNames[o[2]])return!i(o[2],e)}function C(t){return T(t.target.getAttribute("href"))}function q(t,e){E.events.on("ready",function(s){t.update(),e&&e(s)})}function M(){var t=duoshuoQuery.short_name;if(duoshuoQuery.theme&&p(duoshuoQuery.theme),Q){var e=Q["ds_site_"+t],i=Q["ds_lang_"+t];e&&(s.site.data=JSON.parse(e)),i&&N.extend(s._lang,JSON.parse(i))}}var j=$ds,N=t._,E=s._utils={},A=t.Notification,L=s._notifications,Q=t.JSON&&t.JSON.stringify&&t.localStorage,R=E.cache={};E.cache.get=u,E.cache.save=h,E.hostUrl=r,E.normalizeUrl=d,E.loadTheme=p,E.loadRequire=m,E.compileStyle=U,E.encodeHTML=f(),E.jwtParam=n,E.formatQuery=v,E.backgroundParams=g,E.queryIfNecessary=o,E.checkDuoshuoQuery=a,E.parseDate=y(Date),E.fullTime=_,E.elapsedTime=O,E.desktopNotification=c,E.isGuest=l,E.bindUrl=k,E.loginUrl=S,E.logoutUrl=w;var I=E.dialog=riot.observable();I.open=D,I.close=H,E.authInWinHandler=T,E.authClick=C,E.scrollTo=x,E.events=riot.observable(),E.events.ready=q,E.events.on("queryDefined",M)}(t,e,t.DUOSHUO),function(t,e,s,i){"use strict";function o(e,o,n,a,r){function c(t){var e=t.getResponseHeader("Date");e&&(s._timeOffset=new Date-new Date(e))}function u(t,e,s){var i,o,n,d=e;if(t>=200&&300>t||304===t)if(304===t)d="notmodified",n=!0;else try{i=JSON.parse(s),d="success",n=!0}catch(l){d="parsererror",o=l}else{o=d,(!d||t)&&(d="error",0>t&&(t=0));try{i=JSON.parse(s)}catch(l){d="parsererror",o=l}}n?a&&a(i):"parseerror"===d?console.error("解析错误: "+s):(console.error("出错啦("+i.code+"): "+i.errorMessage),r&&r(i),i.errorTrace&&console.error(i.errorTrace)),c(m)}var h=_.getCookie("duoshuo_token");n=n||{},n.v=s.version,h?n.jwt=h:duoshuoQuery.remote_auth&&(n.remote_auth=duoshuoQuery.remote_auth);var p=XMLHttpRequest&&JSON&&JSON.parse;if(p){var m=new XMLHttpRequest,f=!!m&&"withCredentials"in m;if(f){var g;m.open(e,s._utils.hostUrl()+"/api/"+o+".json"+("GET"==e?"?"+_.param(n):""),!0),m.withCredentials=!0,m.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var v=l.get("ds_lastmods");if(v&&t.JSON)try{var b=JSON.parse(v)[duoshuoQuery.short_name];b&&m.setRequestHeader("Accept-Language",b)}catch(y){}return m.send("GET"==e?null:_.param(n)),g=function(t,e){var s,o,n,a;try{if(g&&(e||4===m.readyState))if(g=i,e)4!==m.readyState&&m.abort();else{s=m.status,n=m.getAllResponseHeaders();var r=m.getResponseHeader("Last-Modified");if(r){var d={};d[duoshuoQuery.short_name]=r,l.save("ds_lastmods",d)}try{a=m.responseText}catch(t){}try{o=m.statusText}catch(c){o=""}}}catch(h){e||u(-1,h)}a&&u(s,o,a,n)},void(4===m.readyState?g():m.onreadystatechange=g)}}"GET"!=e&&(n._method="POST");var O="cb_"+Math.round(1e6*Math.random());d[O]=function(t){switch(t.code){case 0:a&&a(t);break;default:r&&r(t),console.error("出错啦("+t.code+"): "+t.errorMessage),t.errorTrace&&console.error(t.errorTrace)}},n.callback="DUOSHUO.API['"+O+"']",_.injectScript(s._utils.hostUrl()+"/api/"+o+".jsonp?"+_.param(n))}function n(t,e,s,i){return e.__comboMode?r("GET",t,e,s,i):this.ajax("GET",t,e,s,i)}function a(t,e,s,i){return e.__comboMode?r("POST",t,e,s,i):this.ajax("POST",t,e,s,i)}function r(t,e,s,i,n){function a(){return d==c[e].len?r():void(d>c[e].len||(d++,setTimeout(a,10)))}function r(){function i(t){return function(s){for(var i=0;i<c[e].cb[t].length;i++)!function(t){t(s)}(c[e].cb[t][i])}}var n={};n[s.queryKey]=c[e].query.join(","),o(t,e,n,i("success"),i("error"))}if(c[e]||(c[e]={}),c[e].query||(c[e].query=[]),c[e].cb||(c[e].cb={}),c[e].cb.success||(c[e].cb.success=[]),c[e].cb.error||(c[e].cb.error=[]),delete s.__comboMode,c[e].query.push(s[s.queryKey]),c[e].cb.success.push(i),c[e].cb.error.push(n),c[e].len=s.__comboLength,!(c[e].query.length>1)){var d=0;setTimeout(a,10)}}var d=s.API={},c=d._combos={},l=s._utils.cache;d.ajax=o,d.get=n,d.post=a}(t,e,t.DUOSHUO),function(t,e,s){"use strict";function i(i){function a(){function i(){var t,e=1===c.readyState;if(e)for(;t=r.messages.shift();)c.send(t)}function a(t){try{var e=JSON.parse(t.data)}catch(i){return}switch(e.type){case"post":var a=s._components.thread;if(!a)return;a.tags.dsComments.addOne(e);break;case"notification":n.push(e),o.desktopNotification()}}var d="https:"===e.location.protocol?"wss://ws.duoshuo.com:8202/":"ws://ws.duoshuo.com:8201/",c=r.webSocket=new WebSocket(d);c.onopen=i,c.onmessage=a,t.addEventListener("beforeunload",function(){c.close()})}if("WebSocket"in t&&t.JSON){var r=this;r.messages.push(t.JSON.stringify(i)),r.webSocket||a(),r.webSocket.onopen()}}var o=s._utils,n=s._notifications,a=s.ws={};a.messages=[],a.send=i}(t,e,t.DUOSHUO);var o="https:"==e.location.protocol?"https:":"http:";DUOSHUO.DOMAIN="duoshuo.com",DUOSHUO.STATIC_URL=o+"//static.duoshuo.com",DUOSHUO.REMOTE=o+"//duoshuo.com",DUOSHUO.version="15.4.13",DUOSHUO._styleMd5={"default":"5c5fd1ac",dark:"155718bb",bluebox:"a36fcf1a",newhua:"233b76c5"},DUOSHUO._libsMd5={"embed.compat":"24f8ca3f",smilies:"921e8eda"},DUOSHUO._lang={post:"发布",posting:"正在发布",settings:"设置",reply:"回复",like:"顶",repost:"转发",report:"举报","delete":"删除",reply_to:"回复 ",reposts:"转发",comments:"评论",floor:"楼",latest:"最新",earliest:"最早",hottest:"最热",share_to:"分享到:",leave_a_message:"说点什么吧…",no_comments_yet:"还没有评论，沙发等你来抢",repost_reason:"请输入转发理由",hot_posts_title:"被顶起来的评论",comments_zero:"暂无评论",comments_one:"1条评论",comments_multiple:"{num}条评论",reposts_zero:"暂无转发",reposts_one:"1条转发",reposts_multiple:"{num}条转发",weibo_reposts_zero:"暂无新浪微博",weibo_reposts_one:"1条新浪微博",weibo_reposts_multiple:"{num}条新浪微博",qqt_reposts_zero:"暂无腾讯微博",qqt_reposts_one:"1条腾讯微博",qqt_reposts_multiple:"{num}条腾讯微博"},riot.tag("ds-avatar",'<div class="ds-avatar"><a rel="nofollow author" target="_blank" if="{ hasLink }" href="{ utils.encodeHTML(user.url) }" onmouseenter="{ bubbleEnter }" onmouseleave="{ bubbleLeave }" onclick="{ user.user_id ? this.href = utils.hostUrl() + \'/user-url/?user_id=\' + user.user_id : \'javascript:void(0);\'}" ><ds-avatar-image user="{ user }" size="{ opts.size }" ></ds-avatar-image></a>  <ds-avatar-image if="{ !hasLink }" user="{ user }" size="{ opts.size }" ></ds-avatar-image><ds-service-icon if="{ opts.icon }" service="{ opts.icon }"></ds-service-icon></div>',function(t){function e(){return!!s.user.user_id}var s=this,i=this.bubble=DUOSHUO._components.bubble;this.utils=DUOSHUO._utils,this.user=t.user,this.on("update",function(){this.hasLink=t.user&&!!t.user.url}),this.bubbleEnter=function(t){if(e()){var s={};s.type="user",s.data=this.user,i.enter(s,t)}}.bind(this),this.bubbleLeave=function(){e()&&i.leave}.bind(this)}),riot.tag("ds-avatar-visitor","<a class=\"ds-avatar\" onclick=\"{ g ? 'return false' : ''}\" target=\"{ g ? '_self' : '_blank'}\" title=\"{ g ? '' : '设置头像'}\" href=\"{ g ? 'javascript:void(0);' : author() }\"><ds-avatar-image user=\"{ opts.user }\" size=\"{ opts.size }\" ></ds-avatar-image></a>",function(){var t=this.utils=DUOSHUO._utils;this.utils.events.ready(this),this.on("update",function(){this.g=t.isGuest()}),this.author=function(){return DUOSHUO.REMOTE+"/settings/avatar/"+t.queryIfNecessary(t.jwtParam())}.bind(this)}),riot.tag("ds-avatar-image",'<img riot-src="{ utils.encodeHTML(makeSrc(opts.user)) }" riot-style="{ opts.size ? makeSize(opts.size) : \'\'}" alt="{ utils.encodeHTML(opts.user.name) }">',function(){this.utils=DUOSHUO._utils,this.utils.events.ready(this),this.makeSrc=function(t){if("undefined"!=typeof t){if(t.avatar_url)return t.avatar_url;if(DUOSHUO.site.data)return DUOSHUO.site.data.default_avatar_url}}.bind(this),this.makeSize=function(t){return"width: "+t+"px; height: "+t+"px;"}.bind(this)}),riot.tag("ds-bubble",'<div id="ds-bubble" riot-style="{ style }" onmouseenter="{ bubbleIn }" onmouseleave="{ bubbleOut }"><div class="ds-bubble-content" id="dsBubbleContent"></div><div class="ds-arrow ds-arrow-down ds-arrow-border"></div><div class="ds-arrow ds-arrow-down"></div></div>',function(){var t=$ds,e=this,s={},i=bubbleOutTimer=0,o=this.dsBubbleContent;this.style="display: none",this.hide=function(){this.style="display: none",this.update()}.bind(this),this.show=function(t){this.style="display: block;"+t,this.update()}.bind(this),this.bubbleIn=function(){bubbleOutTimer&&(clearTimeout(bubbleOutTimer),bubbleOutTimer=0)}.bind(this),this.bubbleOut=function(){bubbleOutTimer=setTimeout(function(){bubbleOutTimer=0,s.tag.unmount(),e.hide()},400)}.bind(this),this.enter=function(n,a){function r(){i=0,s.owner=d,e.bubbleIn();var a=l.offset(),r=t(c).offset(),u=(l.el.offsetWidth+40)/2,h=c.offsetHeight-(a.top-r.top)+6,p=a.left-r.left-35+(u>35?35:u);e.show("bottom:"+h+"px; left:"+p+"px;"),s.tag&&s.tag.unmount();var m={};"ctx"===n.type?(m.comment=n.comment,m.parentComment=n.data):m=n.data,s.tag=riot.mount(o,"ds-bubble-"+n.type,m)}var d=a.target,c=e.root.parentElement;if(bubbleOutTimer&&s.owner==d)return clearTimeout(bubbleOutTimer),void(bubbleOutTimer=0);var l=t(d);i=setTimeout(r,200)}.bind(this),this.leave=function(){i?(clearTimeout(i),i=0):bubbleOutTimer||this.bubbleOut()}.bind(this)}),riot.tag("ds-bubble-user",'<div id="ds-user-card"><a href="{ opts.url }" class="ds-avatar" target="_blank"><ds-avatar-image user="{ opts }"></ds-avatar-image></a><a href="{ opts.url }" class="ds-user-name ds-highlight" target="_blank">{ opts.name }</a><span><a each="{ service in opts.social_uid }" target="_blank" class="ds-service-icon ds-{ service }" title="{ sourceName[service] }" href="{ REMOTE }/user-proxy/{ service }/{ parent.opts.social_uid[service] }/"></a></span><p class="ds-user-card-meta"><a href="{ REMOTE }/profile/{ opts.user_id }/" target="_blank"><span class="ds-highlight">{ opts.comments || 0 }</span>条评论</a></p><p class="ds-user-description" if="{ opts.description }"> { opts.description } </p></div>',function(){this.REMOTE=DUOSHUO.REMOTE,this.sourceName=DUOSHUO.sourceName}),riot.tag("ds-bubble-ctx",'<div id="ds-ctx-bubble"><ul id="ds-ctx"><ds-context-comment comment="{ opts.parentComment }"></ds-context-comment></ul><div class="ds-bubble-footer"><a class="ds-ctx-open" onclick="{ openDialog }" href="javascript:void(0);">查看对话</a></div></div>',function(t){var e=DUOSHUO.API,s=DUOSHUO._utils.dialog;this.openDialog=function(){function i(t){s.open("ds-dialog-ctx-comments",{style:"width: 600px;",bodyStyle:"max-height: 350px; _height: 350px; overflow-y: auto;",comments:t.response})}var o={};o.post_id=t.comment.post_id,e.get("posts/conversation",o,i)}.bind(this)}),riot.tag("ds-comment",'<li class="ds-post" id="{ \'ds-post-\' + comment.post_id }"><div class="ds-post-self">  <ds-avatar user="{ author }" icon="{ comment.source }"></ds-avatar>  <div class="ds-comment-body"><div class="ds-comment-header"><a class="ds-user-name ds-highlight" if="{ author.url }" href="{ author.url }" onmouseenter="{ !isSocial ? bubbleEnter : \'\' }" onmouseleave="{ !isSocial ? bubble.leave : \'\' }" rel="nofollow" target="_blank">{ author.name }</a><span class="ds-user-name" if="{ !!!author.url }">{ author.name }</span></div>  <ol id="ds-ctx" if="{ showDsCtx }"><ds-context-comment each="{ comment, index in parentComments }" hide="{ index && index < comment.parents.length - 1 }" index="{ this.index }" comment="{ this.comment }"></ds-context-comment></ol><p><a class="ds-comment-context" if="{ showDsCtxRef }" data-type="ctx" onmouseenter="{ !isSocial ? bubbleEnter : \'\' }" onmouseleave="{ !isSocial ? bubble.leave : \'\' }" data-post-id="{ comment.post_id }" data-parent-id="{ comment.parent_id }"> { lang.reply_to }{ parentComment.author.name }: </a><ds-comment-message-raw message="{ comment.message }"></ds-comment-message-raw></p><div class="ds-comment-footer ds-comment-actions { \'ds-post-liked\': comment.vote > 0 }"><span if="{ comment.url }"><ds-comment-time-anchor time="{ comment.created_at }" url="{ comment.url }"></ds-comment-time-anchor></span><span if="{ !!!comment.url }"><ds-comment-time-text time="{ comment.created_at }"></ds-comment-time-text></span><ds-reply-comment normal="{ opts.normal }" if="{ !isSocial }"></ds-reply-comment><ds-like-comment if="{ !isSocial }" likes="{ comment.likes }"></ds-like-comment><ds-repost-comment if="{ !isSocial }"></ds-repost-comment><ds-report-comment if="{ !isSocial }"></ds-report-comment><ds-delete-comment if="{ !isSocial }"></ds-delete-comment><ds-weibo-comments comment="{ comment }" if="{ isSocial }"></ds-weibo-comments><ds-weibo-reposts comment="{ comment }" if="{ isSocial }"></ds-weibo-reposts></div><div id="dsInlineReplybox"></div></div></div>  <ul class="ds-children" if="{ showDsChildren }"><ds-comment normal="{ true }" each="{ child in comment.children }" options="{ parent.options }" comment="{ this.child }"></ds-comment></ul></li>',function(t){function e(t){var e=i.comments,s=[];
if(!t||0===t.length)return s;for(var o=0;o<t.length;o++)!function(t){e&&e[t]&&s.push(e[t])}(t[o]);return s}var s=$ds,i=this,o=(DUOSHUO.API,this.bubble=DUOSHUO._components.bubble),n=DUOSHUO._components.thread,a=n.tags.dsComments.tags.dsPager;this.lang=DUOSHUO._lang;var r=this.comment=t.comment;this.author=t.comment.author,this.on("update",function(){this.parent&&this.parent.parent&&(this.comments=1!==a.current?this.parent.parent.comments:this.parent.parent.opts.comments,this.options=t.options||this.parent.parent.opts.options),r.parent_id&&(this.parentComment=e([r.parent_id])[0]),r.parents&&(this.parentComments=e(r.parents));var s=this.options||{};this.showDsCtx=1==s.max_depth&&s.show_context&&r.parents.length,this.showDsCtxRef=r.parents.length>=s.max_depth&&(!s.show_context||s.max_depth>1)&&r.parent_id&&this.parentComment,this.showDsChildren=s&&s.max_depth>1&&(r.childrenArray||r.children)&&"weibo"!=r.source&&"qqt"!=r.source,this.isSocial="qqt"==r.source||"weibo"==r.source}),this.bubbleEnter=function(t){var e={};e.type=s(t.target).attr("data-type")||"user",e.data="user"===e.type?this.author:this.parentComment,"ctx"===e.type&&(e.comment=this.comment),o.enter(e,t)}.bind(this)}),riot.tag("ds-context-comment",'<li class="ds-ctx-entry" if="{ opts.index == 1 && parent.comment.parents.length > 2 }"><a href="javascript:void(0);" onclick="{ expandClick }" class="ds-expand"> 还有{ comment.parents.length - 2 }条评论 </a></li><li class="ds-ctx-entry" if="{ opts.comment }" riot-style="{ opts.hide ? \'display:none\' : \'\' }"><ds-avatar user="{ opts.comment.author }"></ds-avatar><div class="ds-ctx-body"><div class="ds-ctx-head"><ds-comment-user-anchor user="{ opts.comment.author }"></ds-comment-user-anchor><ds-comment-time-anchor time="{ opts.comment.created_at }" url="{ opts.comment.url }"></ds-comment-time-anchor><div class="ds-ctx-nth" if="{ showDsCtxNth() }" title="{ utils.fullTime(opts.comment.created_at) }"> { opts.index + 1 }{ lang.floor } </div></div><div class="ds-ctx-content"><ds-comment-message-raw message="{ opts.comment.message }"></ds-comment-message-raw><div class="ds-comment-actions" if="{ showDsCtxNth() }"><ds-like-comment likes="{ opts.comment.likes }"></ds-like-comment><ds-repost-comment></ds-repost-comment><ds-reply-comment></ds-reply-comment></div></div><div id="dsInlineReplybox"></div></div></li>',function(t){this.utils=DUOSHUO._utils,this.lang=DUOSHUO._lang,this.showDsCtxNth=function(){return t.index>=0}.bind(this),this.expandClick=function(){}.bind(this)}),riot.tag("ds-reply-comment",'<a href="javascript:void(0);" onclick="{ reply }" class="ds-post-reply"><span class="ds-icon ds-icon-reply"></span>{ lang.reply } </a>',function(t){this.lang=DUOSHUO._lang;var e=DUOSHUO._components.thread||(t.normal?o.parent:o.parent.parent),s=e.tags.dsComments,i=this.parent,o=i.parent.parent;o&&"DS-COMMENTS"!==o.root.nodeName&&o.parent&&(o=o.parent.parent),this.reply=function(){o.tags.inlineReplyBox&&o.tags.inlineReplyBox.unmount(),o.replyboxOpen=!o.replyboxOpen;var t=i.comment||i.opts.comment;if(o.lastOpenId&&o.lastOpenId!==t.post_id&&(o.replyboxOpen=!0),o.replyboxOpen){o.lastOpenId=t.post_id;var e={};e.commentsTag=s,e.options=o.opts.options,e.thread=o.opts.thread,e.parent_id=t.post_id,e.inline=!0,o.tags.inlineReplyBox=riot.mount(i.dsInlineReplybox,"ds-reply-box",e)}}.bind(this)}),riot.tag("ds-like-comment",'<a class="ds-post-likes" onclick="{ like }" href="javascript:void(0);"><span class="ds-icon ds-icon-like"></span> { lang.like } <span if="{ likes }">({ likes })</span></a>',function(t){this.lang=DUOSHUO._lang,this.likes=t.likes;var e=DUOSHUO.API,s=DUOSHUO._utils,i=DUOSHUO._utils.dialog;this.like=function(){if(s.isGuest())return void i.open("ds-services-list",{title:"社交帐号登录",style:"width: 300px;"});var o=this.parent.comment||this.parent.opts.comment,n=(t.likes,o.vote>0),a={};a.post_id=o.post_id,a.vote=n?0:1,e.post("posts/vote",a),this.likes+=a.vote?1:-1,o.vote=a.vote,this.parent.update()}.bind(this)}),riot.tag("ds-repost-comment",'<a class="ds-post-repost" onclick="{ repost }" href="javascript:void(0);"><span class="ds-icon ds-icon-share"></span>{ lang.repost } </a>',function(){var t=this;this.lang=DUOSHUO._lang;var e=this.dialog=DUOSHUO._utils.dialog;this.repost=function(){var s={};s.comment=this.parent.comment||this.parent.opts.comment,e.open("ds-dialog-reposts",s,function(){return DUOSHUO._components.thread?DUOSHUO._components.thread.update():void t.parent.parent.parent.parent.update()})}.bind(this)}),riot.tag("ds-report-comment",'<a class="ds-post-report" onclick="{ report }" href="javascript:void(0);"><span class="ds-icon ds-icon-report"></span>{ lang.report } </a>',function(){this.lang=DUOSHUO._lang;var t=DUOSHUO.API;this.report=function(){if(!confirm("确定要举报这条评论吗？"))return!1;var e={};e.post_id=this.parent.comment.post_id,t.post("posts/report",e),alert("感谢您的反馈！")}.bind(this)}),riot.tag("ds-delete-comment",'<a class="ds-post-delete" onclick="{ deleteComment }" href="javascript:void(0);" if="{ parent.comment.privileges.delete }"><span class="ds-icon ds-icon-delete"></span>{ lang.delete } </a>',function(){var t=$ds;this.lang=DUOSHUO._lang;var e=DUOSHUO.API,s=this.parent.comment,i=DUOSHUO._components.thread,o=i.tags.dsComments;this.deleteComment=function(){function i(){o.removeOne(n.post_id)}if(!confirm("确定要删除这条评论吗？"))return!1;var n={};n.post_id=s.post_id,n.nonce=DUOSHUO.nonce,e.post("posts/remove",n,i),t(this.parent.root).remove()}.bind(this)}),riot.tag("ds-weibo-comments",'<a class="ds-weibo-comments" href="javascript:void(0);"> { lang.comments } <span class="ds-count" if="{ !!!opts.comment.type.match(/-comment$/) }">({ opts.comment.comments })</span></a>',function(t){this.lang=DUOSHUO._lang,this.comment=function(){var e=t.comment;0!==e.root_id}.bind(this)}),riot.tag("ds-weibo-reposts",'<a class="ds-weibo-reposts" onclick="{ repost }" href="javascript:void(0);"> { lang.reposts } <span class="ds-count" if="{ !!!opts.comment.type.match(/-comment$/) }">({ opts.comment.reposts })</span></a>',function(t){function e(t){DUOSHUO.support;return s.authInWinHandler(s[s.isGuest()?"loginUrl":"bindUrl"](t)),!1}this.lang=DUOSHUO._lang;var s=DUOSHUO._utils,i=DUOSHUO.visitor,o=s.dialog;this.repost=function(){var s=t.comment,n=s.source;return i.data&&!i.data.social_uid["qqt"==n?"qq":n]?e(n):void o.open("ds-dialog-reposts",{comment:t.comment})}.bind(this)}),riot.tag("ds-comment-user-anchor",'<a rel="nofollow author" if="{ opts.user.url }" target="_blank" href="{ utils.encodeHTML(opts.user.url) }">{ utils.encodeHTML(opts.user.name) }</a><span if="{ opts.separator && opts.index && opts.index == 1 }">{ opts.separator }</span> { !!!opts.user.url ? utils.encodeHTML(opts.user.name) : \'\' }',function(){this.utils=DUOSHUO._utils,this.lang=DUOSHUO._lang}),riot.tag("ds-comment-time-anchor",'<a href="{ opts.url }" if="{ opts.time }" target="_blank" rel="nofollow" class="ds-time" datetime="{ opts.time }" title="{ utils.fullTime(opts.time) }">{ utils.elapsedTime(opts.time) }</a>',function(){this.utils=DUOSHUO._utils}),riot.tag("ds-comment-time-text",'<span class="ds-time" datetime="{ opts.time }" title="{ timeTitle }">{ timeText }</span>',function(t){var e=this,s=DUOSHUO._utils;this.on("update",function(){this.timeText=s.elapsedTime(t.time),this.timeTitle=s.fullTime(t.time)}),setInterval(function(){e.timeText=s.elapsedTime(t.time),e.timeTitle=s.fullTime(t.time)},2e4)}),riot.tag("ds-comment-message-raw","",function(t){this.root.innerHTML=t.message}),riot.tag("ds-comments",'<div class="ds-header ds-gradient-bg" if="{ !opts.normal }"> { lang.hot_posts_title } </div><ds-comments-tab name="dsCommentsTab" if="{ opts.normal }" thread="{ opts.thread }" options="{ opts.options }"></ds-comments-tab><ul class="{ \'ds-comments\': opts.normal }"><ds-comment if="{ !opts.normal || (opts.normal && opts.thread.comments) }" normal="{ parent.opts.normal }" each="{ id, comment in commentsLoop }" comment="{ this.comment }"></ds-comment><ds-comments-placeholder if="{ opts.normal && !opts.thread.comments }"></ds-comments-placeholder></ul><ds-paginator name="dsPager" if="{ opts.normal && opts.thread.comments && cursor && cursor.pages != 1 }" cursor="{ cursor }"></ds-paginator>',function(t){function e(t,e){return t&&e?s(t,e):void 0}function s(t,e){for(var s={},i=0;i<t.length;i++)!function(t){e[t]&&(s[t]=e[t])}(t[i]);return s}this.lang=DUOSHUO._lang;var i=this.tags.dsCommentsTab;this.on("update",function(){this.cursor=this.cursor||t.cursor,this.commentsids||(this.commentsids=t.commentsids),this.comments||(this.comments=t.comments),this.commentsLoop=e(this.commentsids,this.comments)}),this.prepend=function(t){var e=t.post_id;this.commentsids.unshift(e),this.comments[e]=t,this.update(),i.count(1)}.bind(this),this.append=function(t){var e=t.post_id;this.commentsids.push(e),this.comments[e]=t,this.update(),i.count(1)}.bind(this),this.addOne=function(e){t.options&&this["desc"===t.options.order?"prepend":"append"](e)}.bind(this),this.removeOne=function(t){this.comments[t]=null,this.update(),i.count(-1)}.bind(this)}),riot.tag("ds-comments-tab",'<div class="ds-comments-info"><div class="ds-sort"><a class="ds-order-desc { \'ds-current\': current.order == \'desc\' }" data-v="desc" data-type="order" onclick="{ change }">{ lang.latest }</a><a class="ds-order-asc { \'ds-current\': current.order == \'asc\' }" data-v="asc" data-type="order" onclick="{ change }">{ lang.earliest }</a><a class="ds-order-hot { \'ds-current\': current.order == \'hot\' }" data-v="hot" data-type="order" onclick="{ change }">{ lang.hottest }</a></div><ul class="ds-comments-tabs" id="dsCommentsTabs"><li class="ds-tab"><a class="ds-comments-tab-duoshuo { \'ds-current\': current.source == \'duoshuo\' }" href="javascript:void(0);" data-type="source" data-v="duoshuo" onclick="{ change }" ><span class="ds-highlight">{ thread.comments }</span> 条评论</a></li><li class="ds-tab" if="{ opts.options.show_reposts && thread.reposts }"><a class="ds-comments-tab-repost { \'ds-current\': current.source == \'reposts\' }" href="javascript:void(0);"><span class="ds-highlight">{ thread.reposts }</span> 条评论</a></li><li class="ds-tab" if="{ opts.options.show_weibo && thread.weibo_reposts }"><a class="ds-comments-tab-weibo { \'ds-current\': current.source == \'weibo\' }" href="javascript:void(0);" data-type="source" onclick="{ change }" data-v="weibo"><span class="ds-highlight">{ thread.weibo_reposts }</span> 条新浪微博</a></li><li class="ds-tab" if="{ opts.options.show_qqt && thread.qqt_reposts }"><a class="ds-comments-tab-qqt { \'ds-current\': current.source == \'qqt\' }" href="javascript:void(0);" data-type="source" onclick="{ change }" data-v="qqt"><span class="ds-highlight">{ thread.qqt_reposts }</span> 条腾讯微博</a></li></ul></div>',".ds-hide { display: none; }",function(t){function e(t){function e(t){return o[0]&&o[0].unmount(),0!==t.code?s.handleError(t.errorMessage,t.code):void i.parent.update({commentsids:t.response,comments:t.parentPosts,cursor:t.cursor})}var s=i.parent.parent;s.fetch(t,e);var o=riot.mount("#ds-blackhole-indicator","ds-indicator")}var s=$ds,i=this;this.lang=DUOSHUO._lang,this.current={},this.on("update",function(){this.thread||(this.thread=t.thread),t.options&&(this.current.source||(this.current.source=t.options.source||"duoshuo"),this.current.order||(this.current.order=t.options.order||"desc"))}),this.count=function(t,e){this.thread[e||"comments"]+=t,this.update()}.bind(this),this.change=function(i){var o=this.parent.tags.dsPager,n=i.target.getAttribute("data-type"),a=i.target.getAttribute("data-v");this.current[n]=a,"source"===n&&s("#dsReplyBoxBlock")["duoshuo"!==a?"addClass":"removeClass"]("ds-hide");var r={};r.page="order"===n?o.current:1,r.source=this.current.source,r.order=this.current.order,r.max_depth=t.options.max_depth||1,r.limit=t.options.limit||50,e(r),"source"===n&&(o.current=1,o.update())}.bind(this)}),riot.tag("ds-comments-placeholder",'<li class="ds-post ds-post-placeholder"> { lang.no_comments_yet } </li>',function(t){this.lang=t.lang||DUOSHUO._lang}),riot.tag("ds-dialog",'<div id="ds-wrapper" show="{ show }"><div riot-style="{ dialogOptions.style }" class="ds-dialog { dialogOptions.class }" id="ds-reset"><div class="ds-dialog-inner ds-rounded"><div class="ds-dialog-body" riot-style="{ dialogOptions.bodyStyle }" id="dsDialogContent"></div><div class="ds-dialog-footer"><a href="http://duoshuo.com/" target="_blank" class="ds-logo"></a><span>社会化评论框</span></div><a class="ds-dialog-close" onclick="{ dialog.close }" href="javascript:void(0)" title="关闭"></a></div></div></div>',function(){var t=this,e=this.dialog=DUOSHUO._utils.dialog;e.on("open",function(e){t.dialogOptions=e||{},t.show=!0,t.update()}),e.on("close",function(){t.show=!1,t.update()})}),riot.tag("ds-dialog-anonymous",'<h2>社交帐号登录</h2><div class="ds-icons-32"><a class="ds-{ this.s }" onclick="{ parent.utils.authClick }" each="{ s in services }" href="{ parent.utils.loginUrl(s) }"> { parent.sourceName[s] } </a></div><h2 if="{ !opts.options.deny_anonymous }">作为游客留言</h2><form method="post" if="{ !opts.options.deny_anonymous }" onsubmit="{ submitMessage }"><div class="ds-control-group"><input type="text" name="author_name" value="{ visitor.data.name }" required><label for="ds-dialog-name">名字(必填)</label></div><div class="ds-control-group" if="{ opts.options.require_guest_email }"><input type="email" name="author_email" value="{ visitor.data.email }" required><label for="ds-dialog-email">邮箱(必填)</label></div><div class="ds-control-group" if="{ opts.options.require_guest_url }"><input type="url" name="author_url" placeholder="http://" value="{ visitor.data.url }"><label for="ds-dialog-url">网址(可选)</label></div><button type="submit">发布</button></form>',function(t){this.utils=DUOSHUO._utils,this.visitor=DUOSHUO.visitor,this.sourceName=DUOSHUO.sourceName,this.services=["weibo","qq","renren","kaixin","douban"],this.on("mount",function(){this.author_name.focus()}),this.submitMessage=function(){var e=this.author_email.value;return!e&&!t.options.require_guest_email||e.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)?(t.submit({author_name:this.author_name.value,author_email:this.author_email.value,author_url:this.author_url.value}),void this.utils.dialog.close()):(alert("请输入一个有效的email地址."),!1)}.bind(this)}),riot.tag("ds-dialog-ctx-comments",'<h2>查看对话</h2><ol id="ds-ctx"><ds-context-comment each="{ comment, index in opts.comments }" index="{ this.index }" comment="{ this.comment }"></ds-context-comment></ol>',function(){}),riot.tag("ds-dialog-qrcode",'<h2>微信扫一扫，分享到朋友圈</h2><div class="ds-share-qrcode" style="text-align:center;"><img riot-src="{ opts.qrcode_url }" alt="{ opts.url }"></div>',function(){}),riot.tag("ds-dialog-reposts",'<h2>转发到微博</h2><div class="ds-quote"><strong>@{ comment.author.name }</strong>: <ds-comment-message-raw message="{ comment.message }"></ds-comment-message-raw></div><form id="repostForm" onsubmit="{ submitRepost }"><div class="ds-textarea-wrapper"><textarea name="message" title="Ctrl + Enter 快捷提交" placeholder="{ lang.repost_reason }">{ opts.repostMessage || \'\' }</textarea><pre class="ds-hidden-text"></pre></div><div class="ds-actions"><label if="{ !opts.service }"><input type="checkbox" name="service[]" value="weibo" __checked="{ shareVia.weibo }" onclick="{ toggleCheck }"><span class="ds-service-icon ds-weibo"></span>新浪微博 </label><label if="{ !opts.service }"><input type="checkbox" name="service[]" value="qqt" __checked="{ shareVia.qqt }" onclick="{ toggleCheck }"><span class="ds-service-icon ds-qqt"></span>腾讯微博 </label><button type="submit">{ lang.repost }</button></div></form>',function(t){function e(t){var e=[];return Object.keys(t).forEach(function(s){t[s]===!0&&e.push(s)}),e[0]||""}var s=DUOSHUO.API,i=DUOSHUO._utils.dialog;this.lang=DUOSHUO._lang,this.service=t.service,this.comment=t.comment,this.shareVia={},this.on("mount",function(){DUOSHUO.visitor&&(this.shareVia.weibo=!!DUOSHUO.visitor.data.social_uid.weibo,this.shareVia.qqt=!!DUOSHUO.visitor.data.social_uid.qq,this.update())}),this.toggleCheck=function(t){var e=t.target.value;return this.shareVia[e]=!this.shareVia[e],!0}.bind(this),this.submitRepost=function(){function t(){}if(!this.service&&!this.shareVia.weibo&&!this.shareVia.qqt)return alert("还没有选发布到哪儿呢"),!1;var o={};o.post_id=this.comment.post_id,o.message=this.message.value,o["service[]"]=e(this.shareVia),o.nonce=DUOSHUO.nonce,s.post("posts/repost",o,t),i.close()}.bind(this)}),riot.tag("ds-dialog-unread-comments",'<h2>新留言及回复</h2><ul class="ds-unread-list"><li each="{ comment,index in comments }" hide="{ this.removed }"><ds-comment-user-anchor each="{ author,index in comment.authors }" index="{ this.index }" user="{ this.author }" separator="、"></ds-comment-user-anchor> 在 <a class="ds-read" href="{ comment.thread.url + \'#comments\'}" target="_blank"> { comment.thread.title || \'无标题\' } </a> 中回复了你 <a class="ds-delete ds-read" data-thread-id="{ comment.thread.thread_id }" onclick="{ read }" title="知道了" href="javascript:void(0)">知道了</a></li></ul>',function(){function t(t){s.comments=t.response,s.update()}var e=$ds,s=this,i=DUOSHUO.API;i.get("users/unreadComments",{},t),this.read=function(t){t.item.removed=!0;var s={};s.thread_id=e(t.target).attr("data-thread-id"),i.post("threads/read",s)}.bind(this)}),riot.tag("ds-dialog-unread-notifications",'<h2>系统消息</h2><ul class="ds-unread-list"><li each="{ notification in notifications }" hide="{ this.removed }"> { notification.content } <a class="ds-delete ds-read" data-notification-id="{ notification.notification_id }" onclick="{ read }" title="知道了" href="javascript:void(0)">知道了</a></li></ul>',function(){function t(t){s.notifications=t.response,s.update()}var e=$ds,s=this,i=DUOSHUO.API;i.get("users/unreadNotifications",{},t),this.read=function(t){t.item.removed=!0;var s={};s.notification_id=e(t.target).attr("data-notification-id"),i.post("notifications/read",s)}.bind(this)}),riot.tag("ds-error",'<p if="{ opts.error }">评论框出错啦({ opts.error.code }): { opts.error.message }</p>',function(){}),riot.tag("ds-indicator",'<div id="ds-indicator" style="display: block;"></div>',function(){}),riot.tag("ds-waiting",'<div id="ds-waiting"></div>',function(){}),riot.tag("ds-login",'<div id="ds-login" class="ds-login ds-icons-32"><a each="{ service in services }" onclick="{ parent.utils.authClick }" class="ds-{ service }" href="{ parent.loginUrl(service) }">{ parent.sourceName[service] }</a></div>',function(t){this.utils=DUOSHUO._utils,this.sourceName=DUOSHUO.sourceName,this.loginUrl=DUOSHUO._utils.loginUrl,this.on("update",function(){this.services=t.services?t.services.split(","):["weibo","qq","renren","kaixin","douban"]})}),riot.tag("ds-login-buttons",'<div class="ds-login-buttons"><p>社交帐号登录：</p><div class="ds-social-links"><ul class="ds-service-list"><ds-services services="{ cs }"></ds-services><li><a class="ds-more-services" onclick="{ toggle }" href="javascript:void(0)">更多 &raquo;</a></li></ul><ul riot-style="{ makeStyle(show) }" class="ds-service-list ds-additional-services clearfix"><ds-services services="{ as }"></ds-services></ul></div></div>',function(){this.cs=DUOSHUO.commonServices,this.as=DUOSHUO.additionalServices,this.show=!1,this.toggle=function(){this.show=!this.show}.bind(this),this.makeStyle=function(t){return t?"display: block":"display: none"}.bind(this)}),riot.tag("ds-meta",'<div class="ds-meta" if="{ opts.options.like_thread_enabled && !utils.isGuest() }"><a href="javascript:void(0)" onclick="{ like }" class="ds-like-thread-button ds-rounded { \'ds-thread-liked\' : status.liked }"><span class="ds-icon ds-icon-heart"></span><span class="ds-thread-like-text"> { status.liked ? \'已喜欢\' : \'喜欢\' }</span><span class="ds-thread-cancel-like">取消喜欢</span></a><span class="ds-like-panel" if="{ thread.likes }"><span class="ds-highlight">{ thread.likes }</span> 人喜欢 </span></div><ds-like-tootip enable="{ status.enableTooltip }" threadid="{ thread.thread_id }"></ds-like-tootip>',function(t){this.status={},this.thread=t.thread,this.utils=DUOSHUO._utils;var e=DUOSHUO.API;this.on("update",function(){this.thread=t.thread,this.status.liked=this.thread&&this.thread.user_vote>0}),this.utils.events.ready(this),this.like=function(){if(this.thread){var t={};t.thread_id=this.thread.thread_id,t.vote=this.status.liked?0:1,e.post("threads/vote",t),this.status.liked=!this.status.liked,this.thread.user_vote=t.vote,this.status.liked?(this.status.enableTooltip=!0,this.thread.likes+=1):this.thread.likes-=1}}.bind(this)}),riot.tag("ds-like-tootip",'<div class="ds-like-tooltip ds-rounded" show="{ opts.enable }" riot-style="{ styles }"><p>很高兴你能喜欢，分享一下吧：</p><ul><li each="{ service, item in services }"><a class="ds-service-link ds-share-to-{ service } ds-{ service } }" href="{ item.link }"> { item.text } </a></li></ul><p class="ds-like-tooltip-footer"><a class="ds-like-tooltip-close" onclick="{ cancel }">算了</a></p></div>',function(){var t=this,e=DUOSHUO._utils,s={qzone:"QQ空间",weibo:"新浪微博",qqt:"腾讯微博",renren:"人人网",kaixin:"开心网",douban:"豆瓣网",baidu:"百度搜藏",netease:"网易微博",sohu:"搜狐微博"};this.services={},this.styles="left: 0px; top: 35px; display: none;",this.on("update",function(){Object.keys(s).forEach(function(i){t.services[i]={text:s[i],link:e.hostUrl()+"/share-proxy/?"+_.param({service:i,thread_id:t.opts.threadid})}})}),this.cancel=function(){this.parent.status.enableTooltip=!1,this.parent.update()}.bind(this)}),riot.tag("ds-notify",'<div id="ds-notify" riot-style="{ positions(position) }"><div id="ds-reset"><a class="ds-logo" href="http://duoshuo.com/" target="_blank" title="多说"></a><ul class="ds-notify-unread"><li if="{ unread.comments }"><a href="javascript:void(0);" data-type="comments" onclick="{ openDialog }"> 你有{ unread.comments || 0 }条新回复 </a></li><li if="{ unread.notifications }"><a href="javascript:void(0);" data-type="notifications" onclick="{ openDialog }"> 你有{ unread.notifications || 0 }条系统消息 </a></li></ul></div></div>',function(t){var e=$ds,s=DUOSHUO._utils,i=this.dialog=DUOSHUO._utils.dialog;s.events.ready(this),this.on("update",function(){this.unread=t.unread||DUOSHUO.unread.data,this.position=DUOSHUO.site.data?DUOSHUO.site.data.notify_position:null,this.allClear=this.unread?!this.unread.comments&&!this.unread.notifications:!0}),this.openDialog=function(t){i.open("ds-dialog-unread-"+e(t.target).attr("data-type")),this.hide()}.bind(this),this.positions=function(t){return(this.forcedHide||this.allClear)&&(t="hidden"),{hidden:"display: none;","top-right":"top: 24px; right: 24px","bottom-right":"bottom: 24px; right: 24px"}[t||"hidden"]}.bind(this),this.hide=function(){this.forcedHide=!0,this.update()}.bind(this)}),riot.tag("ds-paginator",'<div class="ds-paginator"><div class="ds-border"></div><a href="javascript:void(0);" data-page="{ 1 }" onclick="{ jump }" if="{ showFirstPage }" class="{ \'ds-current\': current == 1 }">1</a><span class="page-break" if="{ current > 3 }">...</span><span><a href="javascript:void(0);" each="{ n in pages }" data-page="{ this.n }" onclick="{ parent.jump }" if="{ n <= parent.edge && n > parent.leftEdge }" class="{ \'ds-current\': parent.current == this.n }">{ n }</a></span><span class="page-break" if="{ hideMore }">...</span><a href="javascript:void(0);" onclick="{ jump }" data-page="{ pages[pages.length - 1] }" class="{ \'ds-current\': current == pages[pages.length - 1] }" if="{ hideMore }">{ pages[pages.length - 1] }</a></div>',function(t){function e(t){for(var e=[],s=0;t>s;s++)e.push(s+1);return e}var s=$ds,i=this.parent.parent;this.leftEdge=1,this.edge=t.edge||5,this.on("update",function(){t.cursor&&(!t.cursor.pages||t.cursor.pages<=1||(this.showFirstPage=t.cursor.pages>1,this.hideMore=t.cursor.pages>5,this.pages=e(t.cursor.pages),this.current||(this.current=1),this.current>=this.edge-1&&(this.edge+=1,this.leftEdge+=1)))}),this.jump=function(t){function e(t){return o[0]&&o[0].unmount(),0!==t.code?i.handleError(t.errorMessage,t.code):void i.tags.dsComments.update({commentsids:t.response,comments:t.parentPosts})}this.current=s(t.target).attr("data-page"),this.update();var o=riot.mount("#ds-blackhole-indicator","ds-indicator"),n={};n.page=this.current,i.fetch(n,e)}.bind(this)}),riot.tag("ds-powered-by",'<p class="ds-powered-by"><a href="http://duoshuo.com" target="_blank" rel="nofollow"> { utils.encodeHTML(opts.options.poweredby_text) } </a></p>',function(){this.utils=t.DUOSHUO._utils}),riot.tag("ds-reply-box",'<div id="{ opts.inline ? \'dsReplyBoxInline\' : \'dsReplyBoxBlock\' }" class="ds-replybox {\'ds-inline-replybox\': opts.inline }">  <ds-avatar-visitor user="{ visitor.data }"></ds-avatar-visitor>  <form id="dsReplyForm" onsubmit="{ submitMessage }" method="post">  <div class="ds-textarea-wrapper ds-rounded-top"><textarea name="message" id="dsMessageTextarea" title="Ctrl + Enter 快捷提交" onkeyup="{ backup }" onblur="{ backup }" onfocus="{ backup }" placeholder="{ lang.leave_a_message }"></textarea>  <pre class="ds-hidden-text"></pre></div>  <div class="ds-post-toolbar"><div class="ds-post-options ds-gradient-bg"><span class="ds-sync" if="{ !utils.isGuest() && repostMap }"><input id="{ opts.inline ? \'ds-sync-checkbox-inline\' : \'ds-sync-checkbox\' }" type="checkbox" name="repost" onchange="{ recheck }" __checked="{ checked }" value="{ repostArray.join(\',\') }"><label for="{ opts.inline ? \'ds-sync-checkbox-inline\' : \'ds-sync-checkbox\' }"> { lang.share_to } </label><ds-service-icon togglemode="{ true }" each="{ service, exist in repostMap }" service="{ this.service }" grey="{ !exist }"></ds-service-icon></span></div>  <button class="ds-post-button { \'ds-waiting\': status.submitting }" __disabled="{ !message || status.submitting }" name="submit" type="submit"> { status.submitting ? lang.posting : lang.post } </button>  <div class="ds-toolbar-buttons"><a if="{ opts.options.use_smilies }" class="ds-toolbar-button ds-add-emote" onclick="{ loadSmilies }" title="插入表情"></a><a if="{ opts.options.use_images && options.parse_html_enabled }" onclick="{ addImage }" class="ds-toolbar-button ds-add-image" title="插入图片"></a></div></div></form></div>',function(t){var s,i=$ds,o=this,n=this.utils=DUOSHUO._utils,a=(n.events,DUOSHUO.API),r=this.submit,d=this.visitor=DUOSHUO.visitor,c=this.dialog=DUOSHUO._utils.dialog;this.lang=DUOSHUO._lang,this.status={},this.on("update",function(){if(this.thread=t.thread,this.options=t.options,this.thread&&this.thread.thread_id&&(this.storageKey="ds_draft_"+this.thread.thread_id),!t.inline&&localStorage&&localStorage[this.storageKey]&&(this.message.value=localStorage[this.storageKey]),d&&d.data&&!this.repostMap){this.repostMap={};for(var e in d.data.repostOptions)o.repostMap[e]=d.data.repostOptions[e],o.repostMap[e]&&(o.checked=1)}}),n.events.ready(this),this.on("mount",function(){this.message.focus()}),riot.observable(this.submit),r.on("submitting",function(){o.status.submitting=!0,o.update()}),r.on("submitted",function(){o.status.submitting=!1,o.update()}),this.backup=function(e){if(e.ctrlKey&&13==e.which||10==e.which)return this.submitMessage();if(!t.inline&&localStorage)try{localStorage[this.storageKey]=this.message.value}catch(e){}}.bind(this),this.recheck=function(t){var e=t.target;e.value=this.checking(e.checked)}.bind(this),this.checking=function(t){var e=this.repostMap,s=[];return Object.keys(e).forEach(function(i){"undefined"!=typeof t&&(e[i]=t),e[i]===!0&&s.push(i)}),s.join(",")}.bind(this),this.submitMessage=function(){function t(t){function e(t){var e=o.options;r.trigger("submitted"),o.message.value="";var s=o.opts.commentsTag||o.parent.tags.dsComments;if(s["desc"===e.order?"prepend":"append"](t.response),"asc"==e.order==("top"==e.formPosition)){var a=i("#ds-post-"+t.response.post_id).offset();n.scrollTo(a.top+a.height-40,300)}if(localStorage)try{localStorage.removeItem("ds_draft_"+o.thread.thread_id)}catch(d){}}function s(t){r.trigger("submitted"),alert(t.errorMessage)}r.trigger("submitting");var d={};d.message=o.message.value,d.thread_id=o.opts.thread.thread_id,d.parent_id=o.opts.parent_id||"",d.nonce=DUOSHUO.nonce,o.repost.value&&(d.repost=o.repost.value),t&&_.extend(d,t),a.post("posts/create",d,e,s)}if(this.status.submitting)return!1;var e=this.message,s=e.value.trim(),d=DUOSHUO.support;return!s||""==s||!d.placeholder&&s==e.getAttribute("placeholder")?alert("您还没写内容呢"):n.isGuest()?void c.open("ds-dialog-anonymous",{style:"width: 320px",options:o.options,submit:t}):void t()}.bind(this),this.loadSmilies=function(){var t=o.message,i=t.getBoundingClientRect();DUOSHUO.require("smilies",function(){DUOSHUO.status.showSmilies=!0;var o={};o.position={top:i.top+e.body.scrollTop+t.offsetHeight+34+"px",left:i.left+e.body.scrollLeft+"px"},s&&s[0].unmount(),s=riot.mount("#ds-blackhole-smilies","ds-smilies",o)})}.bind(this),this.addImage=function(){var t=o.dsMessageTextarea,s=t.value,i="请输入图片地址",n='<img src="'+i+'" />';if(e.selection){t.value=s.substring(0,textarea.data("ds-range-start"))+n+s.substring(textarea.data("ds-range-end"),s.length),t.value=t.value.replace("说点什么吧 ...",""),t.focus();var a=e.selection.createRange();a.collapse(),a.findText(i),a.select()}else{t.value=s.substring(0,t.selectionStart)+n+s.substring(t.selectionEnd);var r=t.value.search(i);t.setSelectionRange(r,r+i.length),t.focus()}}.bind(this)}),riot.tag("ds-services",'<li each="{ s in services }"><a href="{ parent.opts.bindlist ? parent.utils.bindUrl(s) : parent.utils.loginUrl(s) }" rel="nofollow" onclick="{ parent.utils.authClick }" class="ds-service-link ds-{ s }"> { parent.serviceNames[s] } <span if="{ parent.opts.bindlist && parent.visitor.data.social_uid[s] }" class="ds-icon ds-icon-ok"></span></a></li>',function(t){this.utils=DUOSHUO._utils,this.visitor=DUOSHUO.visitor,this.services=t.services,this.serviceNames=DUOSHUO.serviceNames}),riot.tag("ds-services-list",'<h2>{ title }</h2><ul class="ds-service-list"><ds-services services="{ cs }" bindlist="{ opts.bindlist || false }"></ds-services></ul><ul class="ds-service-list ds-additional-services"><ds-services services="{ as }" bindlist="{ opts.bindlist || false }"></ds-services></ul><div style="clear:both" if="{ opts.bindlist }"></div>',function(t){this.cs=DUOSHUO.commonServices,this.as=DUOSHUO.additionalServices,this.title=t.title}),riot.tag("ds-service-icon",'<a href="javascript:void(0)" if="{ sourceName[opts.service] }" class="ds-service-icon{ grey ? \'-grey\' : \'\' } ds-{ opts.service }" onclick="{ opts.togglemode ? toggle : \'javascript:void(0);\'}" data-service="{ opts.service }" title="{ sourceName[opts.service] }" ></a>',function(t){this.sourceName=DUOSHUO.sourceName,this.on("update",function(){"undefined"==typeof this.grey&&(this.grey=t.grey)}),this.toggle=function(){var e=this.parent.parent,s=e.repost;this.grey=!this.grey,e.repostMap[t.service]=!this.grey,s.value=e.checking(),s.checked=""!=s.value}.bind(this)}),riot.tag("ds-smilies",'<div id="ds-smilies-tooltip" riot-style="{ styles }"><ul class="ds-smilies-tabs"><li each="{ smilieType, smilies in smiliesMap }"><a onclick="{ parent.renderSmilies }" class="{ \'ds-current\': smilieType == parent.targetType }" data-type="{ smilieType }" href="javascript:void(0);"> { smilieType } </a></li></ul><div class="ds-smilies-container"><ul if="{ smiliesMap && targetType }"><li each="{ shortCut, imageURI in smiliesMap[targetType] }"><img onclick="{ parent.insertSmilie }" title="{ parent.parseTitle(shortCut) }" riot-src="{ parent.parseSmilie(shortCut, imageURI) }"></li></ul></div></div>',function(t){this.styles="display: none;",t.position&&(this.styles+="top:"+t.position.top+";",this.styles+="left:"+t.position.left,this.styles+="; overflow: hidden;"),this.on("update",function(){this.smiliesMap=DUOSHUO.smilies,this.styles=DUOSHUO.status.showSmilies?this.styles.replace("none;","block;"):this.styles.replace("block;","none;"),this.smiliesMap&&!this.targetType&&(this.targetType="微博-默认")}),this.parseSmilie=function(t,e){var s="http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/";return 0===this.targetType.indexOf("微博")?s+e.replace("_org","_thumb"):DUOSHUO.STATIC_URL+"/images/smilies/"+e
}.bind(this),this.parseTitle=function(t){return"WordPress"===this.targetType&&(t=" "+t+" "),t}.bind(this),this.renderSmilies=function(t){var e=t.target.getAttribute("data-type");this.targetType=e}.bind(this),this.insertSmilie=function(t){var s=e.getElementById("dsMessageTextarea"),i=s,o=i.value,n=t.item.shortCut;if(e.selection){i.value=o.substring(0,s.data("ds-range-start"))+n+o.substring(s.data("ds-range-end"),o.length),i.value=i.value.replace(lang.leave_a_message,""),i.focus();var a=e.selection.createRange();a.moveStart("character",s.data("ds-range-start")+n.length),a.collapse(),a.select()}else{var r=i.selectionStart+n.length;i.value=o.substring(0,i.selectionStart)+n+o.substring(i.selectionEnd),i.setSelectionRange(r,r)}DUOSHUO.status.showSmilies=!1,i.focus()}.bind(this)}),riot.tag("ds-thread",'<div id="ds-thread"><div id="ds-reset" show="{ ready }">  <ds-meta name="dsMeta" options="{ data.options }" thread="{ data.thread }"></ds-meta>  <ds-hot-comments name="dsHotComment" if="{ data.options.hot_posts && data.hotPosts.length }" thread="{ data.thread }" comments="{ data.parentPosts }" commentsids="{ data.hotPosts }" options="{ data.options }"></ds-hot-comments>  <a name="respond"></a>  <ds-toolbar name="dsToolbar"></ds-toolbar>  <ds-reply-box name="dsReplyBox" if="{ data.options && data.options.formPosition == \'top\' }" options="{ data.options }" thread="{ data.thread }"></ds-reply-box>  <ds-comments name="dsComments" normal="{ true }" comments="{ data.parentPosts }" commentsids="{ data.response }" thread="{ data.thread }" cursor="{ data.cursor }" options="{ data.options }"></ds-comments>  <ds-reply-box name="dsReplyBox" if="{ data.options && data.options.formPosition == \'bottom\'}" options="{ data.options }" thread="{ data.thread }"></ds-reply-box><ds-powered-by options="{ data.options }"></ds-powered-by><ds-error error="{ error }"></ds-error><div id="ds-blackhole-bubble"></div></div><ds-waiting if="{ !!!ready }"></ds-waiting></div>  <ds-notify></ds-notify>  <ds-dialog></ds-dialog>',function(t){function e(t){return 0!==t.code?i.handleError(t.errorMessage,t.code):(a.bubble=riot.mount("#ds-blackhole-bubble","ds-bubble")[0],i.ready=!0,i.data=t,void i.update())}var s=$ds,i=this,o=DUOSHUO.API,n=DUOSHUO._utils,a=DUOSHUO._components,r="thread-id local-thread-id source-thread-id thread-key category channel-key author-key author-id url limit order max-depth form-position container-url title image thumbnail";if(this.data={},this.ready=!1,"请将此处替换成文章在你的站点中的ID"===t["data-thread-key"])return alert("请设置正确的 data-thread-key 属性"),!1;var d=t["data-url"]||!t["data-thread-id"]&&s("link[rel=canonical]").attr("href");d?t["data-url"]=n.normalizeUrl(d):t["data-container-url"]=location.href,this.fetch=function(s,i){var a=_.extend({},n.formatQuery(r,t));o.get("threads/listPosts",n.backgroundParams(_.extend(a,s||{})),i||e)}.bind(this),this.fetch(),this.handleError=function(t,e){i.error={code:e,message:t},i.ready=!0,i.update()}.bind(this)}),riot.tag("ds-blackhole",'<div id="ds-blackhole-smilies"></div><div id="ds-blackhole-indicator"></div>',function(){}),riot.tag("ds-toolbar",'<div class="ds-toolbar"><div class="ds-account-control" if="{ !utils.isGuest() }" onmouseenter="{ toggleAccount }" onmouseleave="{ toggleAccount }"><span class="ds-icon ds-icon-settings"></span><span>帐号管理</span><ul><li><a class="ds-bind-more" onclick="{ openDialogBindMore }" href="javascript:void(0);" style="border-top: none">绑定更多</a></li><li><a target="_blank" href="{ uri.settings }">{ lang.settings }</a></li><li><a rel="nofollow" href="{ utils.logoutUrl() }" style="border-bottom: none">登出</a></li></ul></div><div class="ds-visitor" if="{ !utils.isGuest() }"><a class="ds-visitor-name" if="{ visitor && visitor.data.url }" href="{ visitor.data.url }" target="_blank"> { visitor.data.name } </a><span class="ds-visitor-name" if="{ visitor && !visitor.data.url }"> { visitor.data.name } </span><a class="ds-unread-comments-count" if="{ unread.comments }" riot-style="{ inlineCountsStyle }" href="javascript:void(0);" data-type="comments" onclick="{ openDialogUnreadComments }" title="{ title }">{ unread.comments || 0 }</a></div><ds-login-buttons if="{ utils.isGuest() }"></ds-login-buttons></div>',function(){var t=$ds,e=this.utils=DUOSHUO._utils,s=this.dialog=DUOSHUO._utils.dialog;this.uri={},this.uri.settings=DUOSHUO.REMOTE+"/settings/"+e.queryIfNecessary(e.jwtParam()),this.lang=DUOSHUO._lang,this.on("update",function(){this.visitor=DUOSHUO.visitor,this.unread=this.opts.unread||DUOSHUO.unread.data,this.updateTitle()}),e.events.ready(this),this.updateTitle=function(){this.unread&&(this.title=this.unread.comments>0?"你有"+this.unread.comments+"条新回复":"你没有新回复",this.unread.comments>0&&(this.inlineCountsStyle="display: inline;"))}.bind(this),this.toggleAccount=function(e){t(e.target)["mouseenter"===e.type?"addClass":"removeClass"]("ds-active")}.bind(this),this.openDialogBindMore=function(){s.open("ds-services-list",{title:"绑定更多帐号",bindlist:!0,style:"width: 300px"})}.bind(this),this.openDialogUnreadComments=function(){s.open("ds-dialog-unread-comments"),this.parent.tags["ds-notify"].hide()}.bind(this)}),riot.tag("ds-hot-comments",' <div id="ds-hot-posts" class="ds-rounded">  <ds-comments thread="{ opts.thread }" comments="{ opts.comments }" commentsids="{ opts.commentsids }" options="{ opts.options }"></ds-comments></div>',function(){}),riot.tag("ds-recent-comments",'<div id="ds-recent-comments"><li each="{ comments }" class="ds-comment { \'ds-show-avatars\' : parent.opts.show_avatars || parent.defaults.show_avatars }" data-post-id="{ post_id }"><ds-avatar if="{ parent.opts.show_avatars || parent.defaults.show_avatars }" user="{ author }" size="{ parent.opts.avatar_size || parent.defaults.avatar_size }"></ds-avatar><div class="ds-meta"><ds-comment-user-anchor user="{ author }"></ds-comment-user-anchor><ds-comment-time-text if="{ parent.opts.show_time || parent.defaults.show_time }" time="{ created_at }"></ds-comment-time-text></div><div class="ds-thread-title" if="{ parent.opts.show_title || parent.defaults.show_title }">在 <a href="{ thread.url }#comments">{ thread.title }</a> 中评论</div><div class="ds-excerpt">{ message }</div><a if="{ !!!parent.opts.show_title && !!!parent.defaults.show_title }" class="ds-excerpt" title="{ thread.title } 中的评论" href="{ thread.url }#comments">{ message }</a></li></div><ds-waiting if="{ !!!ready }"></ds-waiting>',function(t){function e(t){0===t.code&&(s.comments=t.response,s.defaults=t.options,s.ready=!0,s.update())}var s=this,i=DUOSHUO._utils,o="show-avatars show-time show-title avatar-size show-admin excerpt-length num-items channel-key";this.ready=!1,DUOSHUO.API.get("sites/listRecentPosts",i.formatQuery(o,t),e)}),riot.tag("ds-recent-visitors",'<div id="ds-recent-visitors" class="ds-avatar"><ds-avatar user="{ this.user }" each="{ user in users }" size="{ parent.opts.avatar_size || parent.defaults.avatar_size }"></ds-avatar></div><ds-waiting if="{ !!!ready }"></ds-waiting>',function(t){function e(t){0===t.code&&(s.defaults=t.options,s.users=t.response,s.ready=!0,s.update())}var s=this,i=DUOSHUO._utils,o="show-time avatar-size num-items channel-key";this.ready=!1,DUOSHUO.API.get("sites/listVisitors",i.formatQuery(o,t),e)}),riot.tag("ds-thread-count","",function(t){function e(t){if(t.response&&t.response[a]){var e=i.opts,n=e.type||e["data-type"]||"comments",r=t.response[a][n],d=_.extend(DUOSHUO._lang,t.options);s(o)[e.replace||e["data-replace"]?"replaceWith":"html"](d[n+"_"+(r?r>1?"multiple":"one":"zero")].replace("{num}",r))}}var s=$ds,i=this,o=this.root,n=(DUOSHUO._utils,{});n.__comboMode=t.combo||!0;var a=n.threads=t["thread-key"]||t["data-thread-key"],r=t["channel-key"]||t["data-channel-key"];r&&(a=r+":"+a),n.__comboMode&&(n.queryKey="threads"),t["data-length"]&&(n.__comboLength=t["data-length"]),DUOSHUO.API.get("threads/counts",n,e)}),riot.tag("ds-top-threads",'<div id="ds-top-threads"><li each="{ threads }"><a target="_blank" href="{ url }" title="{ title }">{ title }</a></li></div><ds-waiting if="{ !!!ready }"></ds-waiting>',function(t){function e(t){0===t.code&&(s.threads=t.response,s.ready=!0,s.update())}var s=this,i=DUOSHUO._utils,o="range num-items channel-key";this.ready=!1,DUOSHUO.API.get("sites/listTopThreads",i.formatQuery(o,t),e)}),riot.tag("ds-share",'<div id="ds-share" class="{ \'flat\': opts[\'data-flat\'] }"><div id="ds-reset" class="ds-share-inline"><div class="ds-share-icons-{ size }"><ds-share-icons shareoptions="{ opts }" size="{ size }" flat="{ opts[\'data-flat\'] }" services="weibo,qzone,qqt,wechat" showtoggle="{ true }"></ds-share-icons></div><div class="ds-share-icons-more" show="{ showMore }"><div class="ds-share-icons"><div class="ds-share-icons-inner"><ds-share-icons shareoptions="{ opts }"></ds-share-icons></div><div class="ds-share-icons-footer">{ copyright }</div></div></div></div></div>',function(t){this.on("update",function(){this.size=t["data-size"]||16,this.copyright=t.copyright||"多说分享插件","undefined"==typeof this.showMore&&(this.showMore=!1)}),this.toggleMore=function(){this.showMore=!this.showMore,this.update()}.bind(this)}),riot.tag("ds-share-aside",'<div id="ds-share" class="ds-share-aside-{ position } { \'flat\': opts[\'data-flat\'] }"><div id="ds-reset" class="{ \'slide-to-left\': asideToLeft, \'slide-to-right\': asideToRight }"><div class="ds-share-aside-inner"><ds-share-icons flat="{ opts[\'data-flat\'] }" shareoptions="{ opts }"></ds-share-icons></div><div class="ds-share-aside-toggle" onclick="{ toggleAside }">分享到</div></div></div>',function(t){function e(t){var e="left"===s.position?"asideToRight":"asideToLeft";s[e]=t||!s[e]}var s=this;this.on("update",function(){this.position=t["data-position"]||"left"}),this.toggleAside=function(){e(),this.update()}.bind(this)}),riot.tag("ds-share-icons",'<ul class="ds-share-icons-{ size }"><li if="{ opts.showtoggle }" onclick="{ parent.toggleMore }"><a class="ds-more" href="javascript:void(0);">{ parent.size != 32 ? \'分享到：\' : \'\' }</a></li><li each="{ s in services }"><a class="ds-{ s } { flat: parent.opts.flat }" href="javascript:void(0);" onclick="{ parent.share }" data-service="{ s }">{ parent.size != 32 ? parent.sourceName[s] : \'\' } </a></li></ul>',function(s){var i=DUOSHUO._utils,o=i.dialog,n=["weibo","qzone","sohu","renren","netease","qqt","kaixin","douban","qq","meilishuo","mogujie","baidu","taobao","google","wechat","diandian","huaban","duitang","youdao","pengyou","facebook","twitter","linkedin","msn"];this.sourceName=DUOSHUO.sourceName,this.on("update",function(){this.size=s.size||16,this.services=s.services?s.services.split(","):n}),this.share=function(n){var a=n.target.getAttribute("data-service"),r=s.shareoptions["data-url"];if(!r)return alert("请设置 data-url");if("wechat"===a){var d=i.hostUrl()+"/api/qrcode/getImage.png",c="?size=240&text="+r,l=$ds("#dsDialogContent");return l&&l.el||riot.mount(e.body,"ds-dialog"),void o.open("ds-dialog-qrcode",{qrcode_url:d+c,url:r,style:"width: 320px;"})}var u=i.hostUrl()+"/share-proxy/?"+_.param({service:a,thread_key:s.shareoptions["data-thread-key"],title:s.shareoptions["data-title"],images:s.shareoptions["data-images"],content:s.shareoptions["data-content"],url:r});t.open(u,"_blank")}.bind(this)}),function(t,s){function i(){a(["thread","recent-comments","recent-visitors","top-users","top-threads","login","thread-count","share","share-aside"])}function o(){if(!duoshuoQuery){if(!c.checkDuoshuoQuery())return console.error("缺少 duoshuoQuery 的定义");console.warn("请在加载多说 embed.js 之前定义 duoshuoQuery")}i(),e.body&&riot.mount(e.body,"ds-blackhole"),duoshuoQuery.ondomready&&duoshuoQuery.ondomready()}function n(){function t(t){c.loadRequire(t),c.events.trigger("ready",t)}duoshuoQuery&&duoshuoQuery.short_name&&(c.events.trigger("queryDefined"),d.get("base/site",c.backgroundParams({}),t),d.get("base/visitor",c.backgroundParams({}),t))}function a(t){for(var e=0;e<t.length;e++)!function(t){var e="ds-"+t,s=r("."+e);s.el&&("undefined"==typeof s.el.length||0!==s.el.length)&&s.each(function(s){this.els&&s.setAttribute("data-length",this.els.length),(this.els||!l[t])&&(l[t]=riot.mount(s,e))})}(t[e])}var r=$ds,d=s.API,c=s._utils,l=s._components;i(),n(),t._documentReady(o)}(t,t.DUOSHUO)}}(window,document);
